!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).YouSeeAR=e()}(this,(function(){"use strict";return class YouSeeAR{constructor(t){this.isUseSimd=!0,this.v=document.createElement("video"),this.cc=document.createElement("canvas"),this.ctx=null,this.w=null,this.isTrack=!1,this.s=[],this.op=[0,0],this.listeners=new Map,this.c=t.container,this.ctx=this.cc.getContext("2d",{willReadFrequently:!0})}camera(t=null){return this.iw()?this.cam(t).then((()=>(this.w.postMessage({type:"init",pw:this.s[2],ph:this.s[3]}),this.msg(),Promise.resolve(!0)))).catch((t=>Promise.reject(t))):Promise.reject("load YouSeeAR.worker.js error")}iw(){let t=!1;for(let e of document.scripts)if(e.src.indexOf("YouSeeAR.js")>0){this.w=new Worker(e.src.replace(".js",".worker.js")),t=!0;break}return t}cam(t=null){const e=t||{audio:!1,video:{facingMode:"environment"}};return["autoplay","muted","playsinline"].forEach((t=>this.v.setAttribute(t,""))),this.v.setAttribute("style","position:absolute;top:0;left:0;display:block;width:100% !important;height:100% !important;object-fit:cover;z-index:-1"),this.c.appendChild(this.v),new Promise(((t,s)=>{navigator.mediaDevices.getUserMedia(e).then((e=>{this.v.addEventListener("loadedmetadata",(()=>{console.info(`camera: ${this.v.videoWidth}*${this.v.videoHeight}`),this.s=this.gs(this.v.videoWidth,this.v.videoHeight),this.cc.width=this.s[2],this.cc.height=this.s[3],t(!0)})),this.v.srcObject=e})).catch((t=>{s(t)}))}))}loadMarker(t){this.w.postMessage({type:"loadMarker",marker:t})}msg(){this.w.onmessage=t=>{const e=t.data;switch(null==e?void 0:e.type){case"ready":const t=this.s[2]/this.s[4],s=this.s[3]/this.s[5];let i=e.proj;[0,4,8,12].forEach((e=>i[e]*=t)),[1,5,9,13].forEach((t=>i[t]*=s)),this.emit("Ready",i);break;case"license":e.status||this.pause(),this.emit("License",e.status);break;case"loaded":this.emit("MarkerLoad",e.markers);break;case"loadError":this.emit("MarkerLoadError",e.reason);break;case"found":this.emit("TargetFound",e.index);break;case"tracking":e.matrix&&this.emit("TargetTracking",e.matrix),this.t();break;case"lost":this.emit("TargetLost",e.index);case"losing":this.t()}}}t(){if(!this.isTrack)return!1;this.ctx.drawImage(this.v,0,0,this.v.videoWidth,this.v.videoHeight,this.op[0],this.op[1],this.s[4],this.s[5]);const t=this.ctx.getImageData(0,0,this.s[2],this.s[3]);this.w.postMessage({type:"process",imageData:t},[t.data.buffer])}start(){this.isTrack=!0,this.t()}pause(){this.isTrack=!1}gs(t,e){const s=320/Math.max(t,e/3*4),i=this.isM()?this.c.clientWidth/t:1,a=t*s,r=e*s,h=Math.max(a,r/3*4),o=Math.max(r,a/4*3);return this.op=[(h-a)/2,(o-r)/2],[t*i,e*i,h,o,a,r]}isM(){return/Android|mobile|iPad|iPhone/gi.test(navigator.userAgent)}on(t,e){this.listeners.set(t,e)}emit(t,e){this.listeners.get(t).call(this,e)}}}));
